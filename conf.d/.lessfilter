#!/usr/bin/env zsh

has_cmds() {
    for cmd in "$@"; do
        if ! command -v "$cmd" &> /dev/null; then
            return 1
        fi
    done
    return 0
}

display_command_info() {
    local cmd="$1"
    if command -v "$cmd" &> /dev/null; then
        # Try to show the man page; if not available, show --help; if that fails too, indicate so
        man "$cmd" 2> /dev/null || "$cmd" --help 2> /dev/null || echo "No manual entry or help strings for $cmd"
        return 0
    fi
    return 1
}


mime=$(file -Lbs --mime-type "$1")
category=${mime%%/*}
kind=${mime##*/}

echo "Mime: $mime"
echo "Category: $category"
echo "Kind: $kind"

# if display_command_info "$1"; then
#     exit 0
# fi


case "$mime" in
    application/json)
        if has_cmds jq; then
            jq -Cr . "$1"
        else
            cat "$1"
        fi
        ;;
    image/*)
        if has_cmds chafa; then
            chafa -f symbols "$1"
        elif has_cmds exiftool; then
            exiftool "$1"
        else
            echo "Image: $1"
        fi
        ;;
    text/*)
        if has_cmds bat; then
            bat --color=always "$1"
        elif has_cmd pygmentize; then
            pygmentize "$1" | less
        else
            cat "$1"
        fi
        ;;
    inode/directory)
        if has_cmds exa; then
            exa --git -hl --icons --group-directories-first --no-permissions --octal-permissions --color=always --no-filesize --no-user --no-time "$1"
        elif has_cmds ls; then
            ls -lh "$1"
        else
            echo "Directory: $1"
        fi
        ;;
    *)
        if has_cmds bat; then
            lesspipe.sh "$1" | bat --color=always
        else
            cat "$1"
        fi
        ;;
esac
